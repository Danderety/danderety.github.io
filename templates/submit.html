<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Отправка тикета</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='submit.css') }}">
</head>
<body>
  {% include 'topbar.html' %}

  <div class="main-container">
    <div class="left-form card">
      <h2>Сообщить о проблеме</h2>

      {% if success %}
        <div class="success-message" id="success-message">Проблема успешно отправлена!</div>
        <script>
          setTimeout(() => {
            const el = document.getElementById('success-message');
            if (el) {
              el.style.transition = "opacity 0.5s ease";
              el.style.opacity = 0;
              setTimeout(() => el.remove(), 500);
            }

            // ✅ Удалить ?success=1 из URL без перезагрузки
            const url = new URL(window.location);
            url.searchParams.delete('success');
            window.history.replaceState({}, document.title, url);
          }, 2000);
        </script>

      {% endif %}


      <form method="POST">
        {{ form.hidden_tag() }}

        <div class="form-group">
          {{ form.room.label }} {{ form.room() }}
        </div>

        <div class="form-group">
          {{ form.category.label }} {{ form.category() }}
        </div>

        <div class="form-group">
          {{ form.problem.label }} {{ form.problem() }}
        </div>

        {{ form.submit(class="submit-btn") }}
      </form>
    </div>

    <div class="right-history card">
      <h3>Мои тикеты</h3>
      <ul class="ticket-history">
        {% for ticket in my_tickets %}
        <li class="{% if ticket.status == 'Выполнено' %}done{% endif %}">
          <div><strong>Кабинет:</strong> {{ ticket.room }}</div>
          <div><strong>Дата:</strong> {{ ticket.timestamp.strftime('%d.%m.%Y %H:%M') }}</div>
          <div><strong>Категория:</strong> {{ ticket.category }}</div>
          <div><strong>Статус:</strong> {{ ticket.status }}</div>
        </li>
        {% else %}
        <li>Вы ещё не отправляли тикеты.</li>
        {% endfor %}
      </ul>
    </div>
  </div>
</body>
</html>
